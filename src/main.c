
#include <string.h>
#include <stdio.h>
#include <unistd.h>
#include <arpa/inet.h>

#include "ethercat.h"
#include "ethercat_socket.h"


int main()
{
	int sock = open_socket("eth2");

	// Writing to 0x0010 seems to set the address

	// Setup test frame
	uint8_t data[] = {0x00, 0xd0, 0xb7, 0xbd, 0x22, 0x56,
                    0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                    0x88, 0xa4,
                    0x0e, 0x10,

										// START OF DATAGRAM
										0x04, 	// Auto increment read (was 7 broadcast read)
										0x87, 
										0x02, 0x00, // Auto increment address 1
										0x30, 0x01, // AL status
										//0x10, 0x00,	// Address
										0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x01, 0x00,
										0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
										0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

	uint16_t size = 60;
	send(sock, (void *) data, size, MSG_DONTROUTE | MSG_DONTWAIT);

	// Wait for message
	uint8_t buffer[1024];
	int nbytes = read(sock, (void *) buffer, 1024);

  decode(buffer);

	close(sock);

	return 0;
}

